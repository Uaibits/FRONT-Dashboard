<ub-content [title]="dashboard?.name || 'Dashboard'" [loading]="loading">
  <div class="dashboard-layout">

    <!-- Painel de Filtros Componentizado -->
    <app-dashboard-filters
      [filters]="structure?.filters || []"
      [(filterValues)]="filterValues"
      [(collapsed)]="sidebarCollapsed"
      [loading]="loading"
      (apply)="applyFilters()"
      (clear)="clearFilters()">
    </app-dashboard-filters>

    <!-- Conteúdo Principal -->
    <div class="dashboard-main" [class.sidebar-collapsed]="sidebarCollapsed">

      <!-- Ações do Dashboard (Compacto) -->
      <div class="dashboard-toolbar">
        <div class="toolbar-left">
          <button class="toolbar-btn" (click)="goBack()" title="Voltar">
            <i class="bx bx-arrow-back"></i>
          </button>
          <div class="dashboard-info">
            @if (dashboard?.description) {
              <span class="dashboard-description">{{ dashboard.description }}</span>
            }
          </div>
        </div>
        <div class="toolbar-right">
          <button class="toolbar-btn" (click)="refreshDashboard()" title="Atualizar" [disabled]="loading">
            <i class="bx bx-refresh" [class.bx-spin]="loading"></i>
          </button>
        </div>
      </div>

      <!-- Seções do Dashboard -->
      @for (section of structure?.sections; track section.section.id) {
        <div class="dashboard-section">

          <!-- Header Compacto da Seção -->
          <div class="section-header">
            <h3 class="section-title">
              {{ section.section.title }}
            </h3>
            @if (section.section.description) {
              <div class="section-description">{{ section.section.description }}</div>
            }
          </div>

          <!-- Metric Cards -->
          @if (getMetricWidgets(section.widgets).length > 0) {
            <div class="metrics-grid">
              @for (widget of getMetricWidgets(section.widgets); track widget.id) {
                <app-dashboard-metric-card
                  [widget]="widget"
                  [filters]="filterValues">
                </app-dashboard-metric-card>
              }
            </div>
          }

          <!-- Charts -->
          @if (getChartWidgets(section.widgets).length > 0) {
            <div class="charts-grid">
              @for (widget of getChartWidgets(section.widgets); track widget.id) {
                <app-dashboard-chart
                  [widget]="widget"
                  [filters]="filterValues">
                </app-dashboard-chart>
              }
            </div>
          }

          <!-- Tables -->
          @if (getTableWidgets(section.widgets).length > 0) {
            <div class="tables-grid">
              @for (widget of getTableWidgets(section.widgets); track widget.id) {
                <app-dashboard-table
                  [widget]="widget"
                  [filters]="filterValues">
                </app-dashboard-table>
              }
            </div>
          }

        </div>
      }

      @if (!structure?.sections || structure?.sections?.length === 0) {
        <div class="dashboard-empty">
          <i class="bx bx-data"></i>
          <h4>Nenhuma seção configurada</h4>
          <p>Configure seções e widgets no editor do dashboard.</p>
        </div>
      }

    </div>

  </div>
</ub-content>

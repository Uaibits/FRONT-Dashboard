<!-- Se ainda não salvou as configs básicas, mostra o formulário -->
@if (!showBuilder) {
  <div class="initial-setup">
    <div class="setup-header">
      <div class="setup-icon">
        <i class="bx bx-customize"></i>
      </div>
      <h2>Configuração Inicial do Dashboard</h2>
      <p>Preencha as informações básicas para começar</p>
    </div>

    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="form-grid">
        <div class="form-row">
          <div class="form-col-6">
            <ub-input
              label="Nome do Dashboard"
              placeholder="Ex: Painel de Vendas"
              formControlName="name"
              [error]="FormErrorHandlerService.getError('name', errors)"
              (blur)="generateKey($event)">
            </ub-input>
          </div>

          <div class="form-col-6">
            <ub-input
              label="Chave Única"
              placeholder="Ex: painel-vendas"
              formControlName="key"
              [error]="FormErrorHandlerService.getError('key', errors)"
              [disabled]="!!dashboardKey">
              <small class="hint">Apenas letras minúsculas, números e hífens</small>
            </ub-input>
          </div>
        </div>

        <div class="form-row">
          <div class="form-col-12">
            <ub-textarea
              label="Descrição"
              placeholder="Descreva o propósito deste dashboard"
              formControlName="description"
              [rows]="3"
              [error]="FormErrorHandlerService.getError('description', errors)">
            </ub-textarea>
          </div>
        </div>

        <div class="form-row">
          <div class="form-col-6">
            <ub-input
              label="Ícone"
              placeholder="Ex: bx bx-chart-line"
              formControlName="icon"
              [error]="FormErrorHandlerService.getError('icon', errors)">
              <small class="hint">Use classes do Boxicons</small>
            </ub-input>
          </div>

          <div class="form-col-6 flex-center">
            <ub-toggle-switch
              label="Dashboard Ativo"
              formControlName="active">
            </ub-toggle-switch>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <ub-button
          type="button"
          (click)="modalRef.close()">
          Cancelar
        </ub-button>
        <ub-button
          type="submit"
          [disabled]="form.invalid"
          [loading]="loading">
          Continuar para Configuração
        </ub-button>
      </div>
    </form>
  </div>
} @else {
  <!-- Builder visual completo -->
  <app-dashboard-builder
    [dashboardKey]="dashboardKey!"
    [dashboard]="dashboard!"
    (onClose)="saveAndClose()">
  </app-dashboard-builder>
}

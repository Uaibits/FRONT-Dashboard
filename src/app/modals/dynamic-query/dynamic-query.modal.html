<ub-tabs>
  <ub-tab label="Configuração">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="p-fluid p-formgrid grid">

        <div class="col-12 md:col-6">
          <ub-input
            label="Nome"
            placeholder="Digite o nome da consulta"
            formControlName="name"
            [error]="FormErrorHandlerService.getError('name', errors)"
            (blur)="generateKey($event)"
          ></ub-input>
        </div>

        <div class="col-12 md:col-6">
          <ub-input
            label="Chave"
            placeholder="Digite a chave única da consulta"
            formControlName="key"
            [error]="FormErrorHandlerService.getError('key', errors)"
          ></ub-input>
        </div>

        <div class="col-12">
          <ub-textarea
            label="Descrição"
            placeholder="Descrição da consulta"
            formControlName="description"
            [error]="FormErrorHandlerService.getError('description', errors)"
          ></ub-textarea>
        </div>

        <div class="col-12">
          <ub-dropdown
            label="Serviço"
            placeholder="Escolha o serviço de consulta"
            formControlName="service_slug"
            [error]="FormErrorHandlerService.getError('service_slug', errors)"
            [options]="services"
            optionLabel="name" optionValue="slug" optionDescription="description"
          ></ub-dropdown>
        </div>

      </div>

      <!-- Botão de Salvar -->
      <div class="flex justify-content-end gap-2">
        <ub-button type="submit" [disabled]="form.invalid" [loading]="loading">Salvar</ub-button>
      </div>
    </form>
  </ub-tab>

  @if (dynamicQuery) {
    <ub-tab label="Parâmetros">
      <app-service-parameters
        [dynamicQuery]="dynamicQuery"
        [serviceSlug]="form.get('service_slug')?.value">
      </app-service-parameters>
    </ub-tab>

    <ub-tab label="Filtros">
      <app-dynamic-query-filters
        [queryKey]="dynamicQueryKey!">
      </app-dynamic-query-filters>
    </ub-tab>

    <ub-tab label="Homologar">
      <app-dynamic-query-test
        [dynamicQuery]="dynamicQuery">
      </app-dynamic-query-test>
    </ub-tab>
  }
</ub-tabs>

<div class="app-container">
  <!-- Navegação Principal -->
  <nav class="main-nav">
    <div class="nav-content">
      <!-- Logo e Menu Mobile -->
      <div class="nav-start">

        <div class="company-brand" (click)="goHome()">
          <span class="company-name-part1">Uai</span>
          <span class="company-name-braces">&#123;</span>
          <span class="company-name-part2">Bits</span>
          <span class="company-name-braces">&#125;</span>
        </div>

      </div>

      <!-- Abas (Tabs) - Visível apenas em desktop -->
      @if (!isMobile) {
        <div class="tabs-container">
          <div class="tabs-wrapper">
            <div class="tabs-scroll" #tabsScroll>
              @for (tab of layout.getOpenTabs(); track tab.id) {
                <div class="tab"
                     [class.active]="isTabActive(tab)"
                     (click)="selectTab(tab, $event)">
                  <div class="tab-content">
                    <i class="tab-icon" [ngClass]="tab.icon"></i>
                    <span class="tab-title">{{ tab.title }}</span>
                    <button class="tab-close" (click)="closeTab(tab.id, $event)">
                      <i class="bx bx-x"></i>
                    </button>
                  </div>
                </div>
              }
            </div>

            <!-- Controles de Navegação -->
            @if (showTabControls) {
              <div class="tabs-controls">
                <button class="tab-scroll-button" (click)="scrollTabs('left')" [disabled]="!canScrollLeft">
                  <i class="bx bx-chevron-left"></i>
                </button>
                <button class="tab-scroll-button" (click)="scrollTabs('right')" [disabled]="!canScrollRight">
                  <i class="bx bx-chevron-right"></i>
                </button>
              </div>
            }
          </div>
        </div>
      }

      <!-- Ações e Perfil -->
      <div class="nav-end">
        <!-- Busca - Oculto em mobile -->

        @if (isMobile) {
          <search-screen></search-screen>
        }

        @if (!isMobile) {
          <div class="search-wrapper">
            <search-screen></search-screen>
          </div>
        }

        <!-- Menu do Usuário -->
        <div class="user-menu" [class.open]="isUserMenuOpen" (click)="toggleUserMenu()">
          <div class="user-avatar">
            <i class="bx bx-user"></i>
          </div>
          @if (!isMobile) {
            <div class="user-info">
              <span class="user-name">{{ auth.getUser() ? auth.getUser()?.name : 'Não Autenticado' }}</span>
              <span class="user-role">{{ groupDescription() }}</span>
            </div>
          }
          <i class="bx bx-chevron-down user-menu-arrow"></i>

          <!-- Menu Dropdown -->
          @if (isUserMenuOpen) {
            <div class="user-dropdown">
              <a routerLink="/perfil" class="dropdown-item">
                <i class="bx bx-user"></i>
                <span>Meu Perfil</span>
              </a>
              <a routerLink="/configuracoes" class="dropdown-item">
                <i class="bx bx-cog"></i>
                <span>Configurações</span>
              </a>
              <div class="dropdown-divider"></div>
              <a (click)="auth.logout()" class="dropdown-item">
                <i class="bx bx-log-out"></i>
                <span>Sair</span>
              </a>
            </div>
          }
        </div>
      </div>
    </div>
  </nav>

  <!-- Container Principal -->
  <div class="content-container">
    <router-outlet></router-outlet>
  </div>
</div>

<!-- Menu Mobile -->
@if (isMobile) {
  <div class="mobile-menu" [class.active]="isMobileMenuOpen">
    <div class="mobile-menu-header">
      <h3>Abas Abertas</h3>
      <button class="close-button" (click)="toggleMobileMenu()">
        <i class="bx bx-x"></i>
      </button>
    </div>

    <div class="mobile-tabs">
      <h4>Navegação</h4>
      <div class="mobile-tabs-list">
        @for (tab of layout.getOpenTabs(); track tab.id) {
          <div class="mobile-tab"
               [class.active]="tab.path === layout.getCurrentRoute()"
               (click)="selectMobileTab(tab)">
            <i [class]="tab.icon"></i>
            <span>{{ tab.title }}</span>
            <button class="mobile-tab-close" (click)="closeTab(tab.id, $event)">
              <i class="bx bx-x"></i>
            </button>
          </div>
        }
      </div>
    </div>

    <div class="mobile-menu-footer">
      <button class="mobile-menu-button" (click)="auth.logout()">
        <i class="bx bx-log-out"></i>
        <span>Sair</span>
      </button>
    </div>
  </div>

  <!-- Overlay do Menu Mobile -->
  <div class="mobile-menu-overlay"
       [class.active]="isMobileMenuOpen"
       (click)="toggleMobileMenu()"></div>
}

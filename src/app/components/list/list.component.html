<!-- ub-list.component.html -->
<div class="ub-list-container">
  <!-- Header -->
  <div class="ub-list-header">
    <div class="header-content">
      <div class="header-main">
        <div class="header-info">
          @if (config.display && config.display.title) {
            <h2 class="list-title">{{ config.display.title }}</h2>
          }
          @if (config.display && config.display.subtitle) {
            <p class="list-subtitle">{{ config.display.subtitle }}</p>
          }
        </div>

        <div class="header-actions-inline">
          <!-- Botão de Refresh inline -->
          @if (hasRefreshListener) {
            <button
              class="btn btn-refresh-inline"
              (click)="onRefresh()"
              [attr.title]="mobileView ? 'Recarregar' : ''"
            >
              <i class='bx bx-refresh'></i>
              @if (!mobileView) {
                <span>Recarregar</span>
              }
            </button>
          }

          <!-- Ações Globais inline -->
          @if (config && config.actions && config.actions.length > 0) {
            @for (action of config.actions; track action.label) {
              @if (isActionVisible(action)) {
                <button
                  class="btn"
                  [class]="'btn-' + (action.color || 'primary')"
                  [class.btn-action-inline]="true"
                  [disabled]="action.loading"
                  [attr.title]="mobileView ? action.label : ''"
                  (click)="executeAction(action)"
                >
                  @if (action.icon) {
                    <i [class]="action.icon"></i>
                  }
                  @if (!mobileView) {
                    <span>{{ action.label }}</span>
                  }
                </button>
              }
            }
          }

          <!-- Botão de Exportação inline -->
          @if (config.exportable !== false) {
            <ub-actionbutton
              class="export-action-btn"
              severity="primary"
              icon="bx-download"
              [actions]="exportActions"
            >Exportar</ub-actionbutton>
          }
        </div>
      </div>

      <div class="header-meta">
        <div class="record-count">
          <i class='bx bx-list-ul'></i>
          <span>{{ recordCount }} registro{{ recordCount !== 1 ? 's' : '' }}</span>
          @if (recordCount !== totalCount) {
            <span class="total-hint">de {{ totalCount }}</span>
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Toolbar -->
  <div class="ub-list-toolbar">
    <div class="toolbar-scroll-container">
      <div class="toolbar-content">
        <!-- Busca -->
        @if (config.searchable !== false) {
          <div class="search-box">
            <i class='bx bx-search search-icon'></i>
            <input
              type="text"
              class="search-input"
              placeholder="Buscar..."
              [(ngModel)]="searchTerm"
              (ngModelChange)="filterData()"
            />
            @if (searchTerm) {
              <button class="clear-search" (click)="searchTerm = ''; filterData()" title="Limpar busca">
                <i class='bx bx-x'></i>
              </button>
            }
          </div>
        }

        <!-- Seletor de Visualização -->
        <div class="toolbar-actions">
          <div class="view-selector">
            <button
              class="btn-view"
              [class.active]="viewMode === 'card'"
              (click)="changeView('card')"
              title="Visualização em Cards"
            >
              <i class='bx bx-grid-alt'></i>
            </button>
            <button
              class="btn-view"
              [class.active]="viewMode === 'table'"
              (click)="changeView('table')"
              title="Visualização em Tabela"
            >
              <i class='bx bx-list-ul'></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Content -->
  <div class="ub-list-content">
    @if (filteredData.length > 0) {
      <!-- Card View -->
      @if (viewMode === 'card') {
        <ub-card-list
          [data]="filteredData"
          [fields]="processedFields"
          [config]="config"
          [itemActions]="config.itemActions ?? []"
          (actionClick)="executeAction($event.action, $event.item)"
        ></ub-card-list>
      }

      <!-- Table View -->
      @if (viewMode === 'table') {
        <ub-table-list
          [data]="filteredData"
          [fields]="processedFields"
          [config]="config"
          [itemActions]="config.itemActions ?? []"
          (actionClick)="executeAction($event.action, $event.item)"
        ></ub-table-list>
      }
    }

    <!-- Empty State -->
    @if (filteredData.length === 0) {
      <div class="empty-state">
        <i class='bx bx-search-alt'></i>
        <p>Nenhum registro encontrado</p>
      </div>
    }
  </div>
</div>

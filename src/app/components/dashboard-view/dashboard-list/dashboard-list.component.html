<div class="dashboard-list-container">

  <!-- Header Opcional -->
  @if (showHeader) {
    <div class="list-header">
      <div class="header-content">
        <div class="title-section">
          <h2 class="list-title">
            <i class="bx bx-grid-alt"></i>
            Meus Dashboards
          </h2>
          @if (!loading && dashboards.length > 0) {
            <span class="count-badge">{{ dashboards.length }}</span>
          }
        </div>

        <!-- Mensagem quando N√ÉO h√° dashboard principal -->
        @if (!hasHomeDashboard() && allowSetHome && dashboards.length > 0) {
          <div class="no-home-message">
            <div class="message-content">
              <p class="message-greeting">
                Ol√° <strong>{{ auth.getUserName() }}</strong>! üëã
              </p>
              <p class="message-text">
                Voc√™ tem <strong>{{ dashboards.length }} {{ dashboards.length === 1 ? 'dashboard dispon√≠vel' : 'dashboards dispon√≠veis' }}</strong>, mas ainda n√£o definiu nenhum como principal.
              </p>
              <p class="message-tip">
                <i class="bx bx-bulb"></i>
                <span>Que tal escolher um para ser exibido automaticamente sempre que voc√™ acessar esta p√°gina? Basta clicar no √≠cone <i class="bx bx-star"></i> do dashboard que voc√™ mais utiliza!</span>
              </p>
            </div>
          </div>
        }

        <!-- Mensagem quando J√Å h√° dashboard principal -->
        @else if (hasHomeDashboard() && allowSetHome) {
          <p class="list-subtitle">
            Estes s√£o os dashboards que voc√™ pode acessar.<br>
            Voc√™ pode alterar o dashboard principal a qualquer momento.
          </p>

          <!-- Indicador de Dashboard Principal -->
          <div class="home-dashboard-indicator">
            <i class="bx bxs-star"></i>
            <span><strong>Dashboard Principal:</strong> {{ getHomeDashboard()?.name }}</span>
          </div>
        }

        <!-- Mensagem padr√£o (sem allowSetHome) -->
        @else {
          <p class="list-subtitle">
            Ol√° <b>{{ auth.getUserName() }}</b>,<br>
            Estes s√£o os dashboards que voc√™ pode acessar.
          </p>
        }
      </div>
    </div>
  }

  <!-- Estado de Loading -->
  @if (loading) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Carregando dashboards...</p>
    </div>
  }

  <!-- Estado de Erro -->
  @else if (error) {
    <div class="error-state">
      <div class="error-icon">
        <i class="bx bx-error-circle"></i>
      </div>
      <h3 class="error-title">N√£o foi poss√≠vel carregar</h3>
      <p class="error-message">{{ error }}</p>
      <button class="retry-button" (click)="retry()">
        <i class="bx bx-refresh"></i>
        Tentar Novamente
      </button>
    </div>
  }

  <!-- Grid de Dashboards -->
  @else if (dashboards.length > 0) {
    <div class="dashboards-grid" [style.grid-template-columns]="getGridColumns()">
      @for (dashboard of dashboards; track dashboard.key) {
        <div class="dashboard-card"
             [class.is-home]="dashboard.is_home"
             [class.highlight-star]="!hasHomeDashboard() && allowSetHome"
             (click)="selectDashboard(dashboard)">

          <div class="card-header">
            <!-- √çcone e Badge Principal -->
            <div class="card-icon">
              <i [class]="getIconClass(dashboard)"></i>
              @if (dashboard.is_home) {
                <div class="home-badge"></div>
              }
            </div>

            <!-- Menu de A√ß√µes (minimalista) -->
            <div class="card-menu">
              @if (allowSetHome && !dashboard.is_home) {
                <button
                  class="set-home-btn"
                  [class.pulsing]="!hasHomeDashboard()"
                  (click)="setAsHomeDashboard(dashboard, $event)"
                  [disabled]="settingHome[dashboard.key]"
                  title="Definir como principal">
                  @if (settingHome[dashboard.key]) {
                    <i class="bx bx-loader-alt bx-spin"></i>
                  } @else {
                    <i class="bx bx-star"></i>
                  }
                </button>
              }
            </div>
          </div>

          <div class="card-content">
            <h3 class="card-title">{{ dashboard.name }}</h3>
            @if (dashboard.description) {
              <p class="card-description">{{ dashboard.description }}</p>
            }
          </div>

          <!-- Indicador de sele√ß√£o -->
          <div class="card-footer">
            <span class="select-hint">
              <i class="bx bx-chevron-right"></i>
              Visualizar
            </span>
          </div>
        </div>
      }
    </div>
  }

  <!-- Estado Vazio -->
  @else {
    <div class="empty-state">
      <div class="empty-icon">
        <i class="bx bx-bar-chart-alt-2"></i>
      </div>
      <h3>Nenhum dashboard dispon√≠vel</h3>
      <p>Voc√™ ainda n√£o tem acesso a nenhum dashboard</p>
    </div>
  }

</div>
